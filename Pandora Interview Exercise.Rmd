---
title: "Pandora Interview Exercise"
author: "crabess"
date: "June 11, 2015"
output: word_document
---

"1. Please create a way to visually compare monthly uniques on eaach platform from Jan 2010 to Dec 2011."

Loading packages:

```{r}
library(openxlsx)
library(reshape)
library(plyr)
library(scales)
library(ggplot2)
```

Loading and subsetting the data:

```{r}
dat <- read.xlsx("2015-03-19 Product Analytics - Sample Data[3].xlsx", sheet = "Monthly Uniques", detectDates = TRUE)
dat$Row.Labels <- as.Date(x=paste("1",dat$Row.Labels,sep="-"),"%d-%Y-%m") #coerce to dates
dat$Row.Labels <- format.Date(dat$Row.Labels,"%Y-%m") #return to original format
dat <- dat["2010-01" <= dat$Row.Labels & "2011-12" >= dat$Row.Labels,] #filter for 2010-2011
```

Formatting the data:
```{r}
dat <- melt(dat) #transform data from wide to long
dat <- ddply(dat, .(variable),transform,rescale = rescale(value)) #scaling monthly uniques for relative comparison
```

Plotting the data - comparison of absolute monthly unique user trend by platform:

```{r}
ggplot(dat,aes(x=Row.Labels, y=value,fill=variable)) + geom_bar(stat = "identity") + facet_wrap(~variable,ncol=1) + scale_x_discrete(breaks = c("2010-01","2010-04","2010-07","2010-10","2011-01","2011-04","2011-07","2011-10"), labels = c("Q1-10","Q2-10","Q3-10","Q4-10","Q1-11","Q2-11","Q3-11","Q4-11")) + theme(axis.title.x = element_blank(), legend.position="none", axis.text=element_text(size=16), axis.title=element_text(size=18)) + ylab("Unique Monthly Users") + scale_y_continuous(labels = comma)
```

Plotting the data - comparison of relative monthly unique user trend by platform:
```{r}
ggplot(dat,aes(x=Row.Labels, y=rescale,fill=variable)) + geom_bar(stat = "identity") + facet_wrap(~variable,ncol=1) + scale_x_discrete(breaks = c("2010-01","2010-04","2010-07","2010-10","2011-01","2011-04","2011-07","2011-10"), labels = c("Q1-10","Q2-10","Q3-10","Q4-10","Q1-11","Q2-11","Q3-11","Q4-11")) + theme(axis.title.x = element_blank(), legend.position="none", axis.text=element_text(size=16), axis.title=element_text(size=18)) + ylab("Unique Monthly Users")
```

"2. Devise a single* metric to measure how successful we were at keeping listeners using the service on a daily basis during December 2011. By this metric, which are the top three platforms?"

Load packages:

```{r}
library(openxlsx)
library(reshape)
library(quantmod)
```

Loading and formatting the data:

```{r}
dat <- read.xlsx("2015-03-19 Product Analytics - Sample Data[3].xlsx",sheet = "Daily Uniques",detectDates = TRUE)
mdat <- dat[dat$Date>="2011-11-30" & dat$Date<="2011-12-31",]
mdat <- melt(mdat,id="Date")
```

Calculating the % change (daily) by platform in Dec-11:

```{r}
changes <- tapply(mdat$value,mdat$variable,Delt) #fxn that calcs % change
```

Calculating the average % change (daily) removing max and min values:

```{r}
lapply(changes,function(x) mean(x[-max(x,na.rm = TRUE) & -min(x, na.rm = TRUE)],na.rm = TRUE))
```

"3. Comparing Dec 2010 to Dec 2011, which platforms experience the highest year-over-year growth in average listener hours per monthly unique?"

Loading packages:

```{r}
library(openxlsx)
```

Loading and formatting the data:

```{r}
uniques <- read.xlsx("2015-03-19 Product Analytics - Sample Data[3].xlsx", sheet = "Monthly Uniques", detectDates = TRUE)
hours <- read.xlsx("2015-03-19 Product Analytics - Sample Data[3].xlsx", sheet = "Hours", detectDates = TRUE)
```

Calculating hours per user and yoy growth:

```{r}
per_unique <- data.frame(Date=hours[,1],hours[,2:7]/uniques[,2:7])
per_unique[36,2:7]/per_unique[23,2:7]-1
```